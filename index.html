<!DOCTYPE html>
<html lang="tk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üè† GARAKEL MARKET | 2026</title>
    
    <style>
        :root { 
            --arka: #000000; --kart: #121212; --tekst: #ffffff; 
            --yasyl: #4caf50; --sary: #ffcc00; --shado: 0 10px 40px rgba(0,0,0,0.9);
            --gradi: linear-gradient(135deg, #1b5e20 0%, #0d3210 100%);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; outline: none; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--arka); color: var(--tekst); padding-bottom: 250px; }

        header { 
            position: fixed; top: 0; width: 100%; height: 90px; background: rgba(0,0,0,0.95); z-index: 5000; 
            border-bottom: 2px solid #222; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .status-bar { position: absolute; top: 0; background: var(--sary); color: #000; width: 100%; font-size: 11px; font-weight: 900; text-align: center; padding: 5px 0; z-index: 5001; }
        .logo { font-size: 24px; font-weight: 900; letter-spacing: 3px; color: #fff; margin-top: 15px; }

        .container { max-width: 850px; margin: auto; padding-top: 100px; }

        /* üéûÔ∏è SLIDER - HD KOSMETIKA */
        .slider { width: 94%; height: 250px; margin: 10px auto; overflow: hidden; border-radius: 30px; border: 1px solid #333; position: relative; background: #fff; }
        .track { display: flex; height: 100%; transition: 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .slide { min-width: 100%; height: 100%; flex-shrink: 0; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .card { background: var(--kart); border-radius: 30px; padding: 18px; text-align: center; border: 1px solid #222; position: relative; display: flex; flex-direction: column; justify-content: space-between; }
        
        .p-no { position: absolute; top: 10px; left: 10px; background: var(--sary); color: #000; padding: 4px 10px; border-radius: 10px; font-size: 11px; font-weight: 900; z-index: 10; }
        .p-status { position: absolute; top: 10px; right: 10px; background: var(--yasyl); color: #fff; padding: 4px 10px; border-radius: 10px; font-size: 10px; font-weight: 900; z-index: 10; }

        .img-w { height: 150px; background: #fff; border-radius: 20px; display: flex; align-items: center; justify-content: center; padding: 12px; cursor: pointer; }
        .img-w img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .p-name { font-size: 15px; font-weight: bold; margin: 15px 0 5px 0; height: 40px; overflow: hidden; }
        
        /* üìä VIEWS & LIKES ROW */
        .stats-row { display: flex; justify-content: space-around; font-size: 12px; color: #888; margin-bottom: 10px; }
        .stats-row span { display: flex; align-items: center; gap: 4px; }

        .price { color: var(--yasyl); font-size: 20px; font-weight: 900; margin-bottom: 12px; }
        
        .btn-group { display: flex; gap: 5px; margin-bottom: 10px; }
        .btn-like { flex: 1; padding: 10px; border-radius: 12px; border: 1px solid #333; background: #1a1a1a; color: #ff4757; font-weight: bold; cursor: pointer; }
        .btn-add-main { background: var(--gradi); color: #fff; border: none; padding: 15px; border-radius: 18px; width: 100%; font-weight: bold; cursor: pointer; }

        .home-comments { margin: 30px 15px; padding: 20px; background: var(--kart); border-radius: 30px; border: 1px solid #222; }
        .h-c-item { background: #000; padding: 15px; border-radius: 20px; margin-bottom: 12px; border: 1px solid #333; font-size: 13px; text-align: left; cursor: pointer; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; align-items: center; justify-content: center; background: rgba(0,0,0,0.96); padding: 20px; }
        .m-box { background: var(--kart); width: 100%; max-width: 480px; max-height: 90vh; border-radius: 40px; position: relative; border: 1px solid #333; overflow-y: auto; padding: 30px; }
        .close { position: absolute; top: 20px; right: 25px; font-size: 35px; color: var(--sary); cursor: pointer; }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #000; border-top: 1px solid #222; z-index: 6000; }
        .admin-footer { background: #111; color: #ffffff; font-size: 12px; text-align: center; padding: 15px; }
        .visit-bar { background: #000; color: #aaa; font-size: 11px; text-align: center; padding: 10px; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .live-dot { width: 8px; height: 8px; background: #ff0000; border-radius: 50%; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<header>
    <div id="statusText" class="status-bar">√ù√ºklen√Ω√§r...</div>
    <div class="logo">GARAKEL</div>
</header>

<div class="container">
    <div class="slider">
        <div class="track" id="sliderTrack">
            <div class="slide"><img src="https://images.unsplash.com/photo-1556228720-195a672e8a03?auto=format&fit=crop&q=80&w=1200"></div>
            <div class="slide"><img src="https://images.unsplash.com/photo-1612817288484-6f916006741a?auto=format&fit=crop&q=80&w=1200"></div>
            <div class="slide"><img src="https://images.unsplash.com/photo-1596462502278-27bfdc4033c8?auto=format&fit=crop&q=80&w=1200"></div>
            <div class="slide"><img src="https://images.unsplash.com/photo-1571781926291-c477ebfd024b?auto=format&fit=crop&q=80&w=1200"></div>
        </div>
    </div>

    <div id="pGrid" class="grid"></div>

    <div class="home-comments">
        <h3 style="color:var(--sary); margin-bottom:15px; border-left:4px solid var(--sary); padding-left:12px;">üí¨ M√º≈üderi Teswirleri</h3>
        <div id="homeCList" class="h-c-list">√ù√ºklen√Ω√§r...</div>
    </div>
</div>

<div id="hModal" class="modal">
    <div class="m-box">
        <span class="close" onclick="closeH()">&times;</span>
        <div style="background:#fff; border-radius:25px; padding:20px; display:flex; justify-content:center; margin-bottom:20px;">
            <img id="hImg" src="" style="max-width:180px; max-height:180px; object-fit:contain;">
        </div>
        <h2 id="hName" style="color:var(--sary); margin-bottom:10px;"></h2>
        <p id="hDesc" style="font-size:14px; color:#ccc; margin-bottom:20px;"></p>
        <div id="hPrice" class="price" style="font-size:28px;"></div>
        
        <div id="commentSection" style="border-top:1px solid #333; padding-top:20px; margin-top:10px;">
            <h4>üí¨ Teswirler</h4>
            <div id="modalCList" style="max-height:180px; overflow-y:auto; margin-bottom:15px;"></div>
            <div style="display:flex; gap:8px;">
                <input type="text" id="cInp" placeholder="Ady≈àyz" style="width:30%; padding:12px; border-radius:12px; background:#000; border:1px solid #333; color:#fff;">
                <input type="text" id="mInp" placeholder="Teswir..." style="flex:1; padding:12px; border-radius:12px; background:#000; border:1px solid #333; color:#fff;">
                <button onclick="addC()" style="background:var(--yasyl); border:none; padding:12px; border-radius:12px; color:#fff; font-weight:bold;">Ugrat</button>
            </div>
        </div>
    </div>
</div>

<div class="bottom-nav">
    <div class="admin-footer">Admin: <b>Me≈àli A≈üyrowa</b> | Garakel i√ßine <b>MUGT</b> eltip bermek!</div>
    <div class="visit-bar">
        <div class="live-dot"></div> ≈ûu g√ºn: <span id="vCount" style="color:var(--sary); margin-right:12px;">0</span> | Jemi: <span id="totalVCount" style="color:var(--yasyl);">0</span>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAdyL0Aqq19afQU0jHoqgH6EUvmZQRq-hY", databaseURL: "https://garakel-dukan-default-rtdb.firebaseio.com", projectId: "garakel-dukan" };
    firebase.initializeApp(firebaseConfig); const db = firebase.database();
    
    let allP = [], currentId = null;

    db.ref('status').on('value', snap => { document.getElementById('statusText').innerText = snap.val() || "Garakel Market"; });

    db.ref().on('value', mainSnap => {
        const data = mainSnap.val() || {};
        const pData = data.products || {};
        const cData = data.comments || {};

        allP = Object.keys(pData).map(k => ({id:k, ...pData[k]})).reverse();
        
        document.getElementById('pGrid').innerHTML = allP.map((h, i) => `
            <div class="card">
                <div class="p-no">‚Ññ${allP.length - i}</div>
                ${h.status ? `<div class="p-status">${h.status}</div>` : ''}
                <div class="img-w" onclick="openH('${h.id}')">
                    <img src="https://raw.githubusercontent.com/menliasyrowa91-a11y/Mengli_shop/main/${h.img}">
                </div>
                <div class="p-name">${h.name}</div>
                <div class="stats-row">
                    <span>üëÅÔ∏è ${h.views || 0}</span>
                    <span>‚ù§Ô∏è ${h.likes || 0}</span>
                </div>
                <div>
                    <div class="price">${h.price} TMT</div>
                    <div class="btn-group">
                        <button class="btn-like" onclick="doLike('${h.id}')">‚ù§Ô∏è Like</button>
                    </div>
                    <button class="btn-add-main" onclick="alert('Sebede go≈üuldy!')">üõí Sebede go≈ü</button>
                </div>
            </div>`).join('');

        let cHtml = ""; let combined = [];
        Object.keys(cData).forEach(pId => {
            const haryt = allP.find(p => p.id === pId);
            Object.values(cData[pId]).forEach(c => { combined.push({ ...c, pId, pName: haryt ? haryt.name : "Haryt" }); });
        });
        combined.sort((a,b) => b.time - a.time).forEach(c => {
            cHtml += `<div class="h-c-item" onclick="openH('${c.pId}')"><b>üì¶ ${c.pName}:</b><br><b>${c.name}:</b> ${c.text}</div>`;
        });
        document.getElementById('homeCList').innerHTML = cHtml || "Teswir √Ωok.";
    });

    function openH(id) {
        currentId = id; const h = allP.find(p => p.id === id);
        if(!h) return;
        
        // G√∂r√ºlen sanyny artdyrmak
        db.ref('products/'+id+'/views').transaction(v => (v||0)+1);

        document.getElementById('hImg').src = "https://raw.githubusercontent.com/menliasyrowa91-a11y/Mengli_shop/main/"+h.img;
        document.getElementById('hName').innerText = h.name;
        document.getElementById('hDesc').innerText = h.desc || "Hilli √∂n√ºm.";
        document.getElementById('hPrice').innerText = h.price + " TMT";

        db.ref('comments/'+id).on('value', s => {
            let htm = ""; const d = s.val();
            if(d) Object.values(d).reverse().forEach(c => {
                htm += `<div style="background:#1a1a1a; padding:10px; border-radius:10px; margin-bottom:5px;"><b>${c.name}:</b> ${c.text}</div>`;
            });
            document.getElementById('modalCList').innerHTML = htm || "Teswir √Ωok.";
        });
        document.getElementById('hModal').style.display = 'flex';
        setTimeout(() => { document.getElementById('commentSection').scrollIntoView({behavior:'smooth'}); }, 300);
    }

    function doLike(id) {
        db.ref('products/'+id+'/likes').transaction(v => (v||0)+1);
    }

    function addC() {
        const n = document.getElementById('cInp').value || "M√º≈üderi", t = document.getElementById('mInp').value;
        if(t && currentId) {
            db.ref('comments/'+currentId).push({ name: n, text: t, time: Date.now() });
            document.getElementById('mInp').value = "";
        }
    }

    function closeH() { document.getElementById('hModal').style.display = 'none'; }

    let sIdx = 0; setInterval(() => { 
        sIdx = (sIdx + 1) % 4; 
        const tr = document.getElementById('sliderTrack');
        if(tr) tr.style.transform = `translateX(-${sIdx * 100}%)`; 
    }, 4500);

    const tdy = new Date().toISOString().slice(0, 10);
    db.ref('visits/' + tdy).transaction(v => (v || 0) + 1);
    db.ref('visits/' + tdy).on('value', s => { document.getElementById('vCount').innerText = s.val() || 0; });
    db.ref('total_visits').transaction(v => (v || 0) + 1);
    db.ref('total_visits').on('value', s => { document.getElementById('totalVCount').innerText = s.val() || 0; });
</script>
</body>
</html>
