<!DOCTYPE html>
<html lang="tk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè† ‚õ∞Ô∏è GARAKEL E-D√úKAN</title>
    <style>
        :root { --bag: #2e7d32; --arka: #121212; --kart: #1e1e1e; --tekst: #ffffff; --yasyl: #4caf50; --sary: #ff9800; }
        .light-mode { --arka: #f4f4f4; --kart: #ffffff; --tekst: #121212; }
        
        body { font-family: -apple-system, sans-serif; margin: 0; background: var(--arka); color: var(--tekst); padding-bottom: 120px; transition: 0.3s; }
        
        /* Modallar */
        #welcomeModal, #productModal, #cartModal, #orderSuccess { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 30000; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); }
        .modal-content { background: var(--kart); width: 90%; max-width: 500px; padding: 25px; border-radius: 20px; position: relative; max-height: 85vh; overflow-y: auto; border: 1px solid #333; color: var(--tekst); }
        
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 30px; color: white; cursor: pointer; }
        .btn-green { background: var(--bag); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }

        header { position: fixed; top: 0; width: 100%; height: 60px; background: #000; color: white; text-align: center; z-index: 10000; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-around; }
        .delivery-bar { background: var(--sary); color: #000; text-align: center; padding: 6px 0; font-size: 13px; font-weight: bold; position: fixed; top: 60px; width: 100%; z-index: 9999; display: flex; align-items: center; justify-content: center; gap: 8px; }

        .container { max-width: 800px; margin: auto; padding-top: 105px; }
        
        /* G√∂zleg */
        .search-container { padding: 10px; }
        .search-container input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #444; background: var(--kart); color: var(--tekst); box-sizing: border-box; outline: none; }

        /* Slider */
        .slider-container { width: 95%; height: 180px; margin: 10px auto; overflow: hidden; border-radius: 15px; background: #fff; position: relative; }
        .slides { display: flex; transition: 0.6s ease-in-out; height: 100%; }
        .slide { min-width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .slide img { max-width: 100%; max-height: 100%; object-fit: contain; }

        /* Kategori√Ωalar */
        .categories { display: flex; overflow-x: auto; gap: 8px; padding: 10px; position: sticky; top: 95px; background: var(--arka); z-index: 999; scrollbar-width: none; }
        .cat-btn { background: #333; border: none; padding: 8px 18px; border-radius: 20px; white-space: nowrap; font-size: 13px; font-weight: bold; color: white; cursor: pointer; }
        .cat-btn.active { background: var(--bag); }

        /* Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: var(--kart); border-radius: 15px; padding: 12px; text-align: center; border: 1px solid #333; cursor: pointer; }
        .card img { width: 100%; height: 120px; object-fit: contain; border-radius: 8px; }
        .stars { color: #ffca28; font-size: 12px; margin: 5px 0; }

        /* Teswirler */
        .comm-box { background: var(--kart); padding: 15px; border-radius: 15px; margin: 15px; border: 1px solid #333; }
        .c-item { border-bottom: 1px solid #333; padding: 12px 0; font-size: 14px; }
        .reply { margin-left: 20px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; margin-top: 8px; font-size: 12px; border-left: 3px solid var(--bag); }

        /* Sargyt edildi Toast */
        #saleNotify { display: none; position: fixed; bottom: 80px; left: 10px; right: 10px; background: var(--kart); border-left: 5px solid var(--yasyl); padding: 12px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); z-index: 30000; align-items: center; gap: 10px; }

        .footer { text-align: center; padding: 20px; color: #777; font-size: 11px; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #333; z-index: 1000; }
    </style>
</head>
<body>

<div id="welcomeModal">
    <div class="modal-content" style="text-align: center; border: 2px solid var(--bag);">
        <h2 style="color: var(--yasyl);">Salam m√§hriban m√º≈üderiler!</h2>
        <p style="line-height: 1.6; text-align: justify; font-size: 14px;">
            Sizi Online d√ºkanymyzda ho≈ü g√∂rd√ºk! Siz bu platformada se√ßip-sa√Ωlap haryt alyp bilersi≈àiz. <br><br>
            üîç <b>Haryt maglumatyny bilmek √º√ßin:</b> Olary≈à √ºst√ºne basy≈à. <br><br>
            üõí <b>Sargamak √º√ßin:</b> "Sebede go≈ü" d√ºwmesine basy≈à, so≈àra a≈üakdaky sebet di√Ωen √Ωazga bassa≈àyz, sa√Ωlan harytlary≈à bahasyny we jemini g√∂r√ºp bilersi≈àiz. <br><br>
            üí¨ Soraglary≈àyz, pikirleri≈àiz bar bolsa arka√Ωyn teswirlerde pa√Ωla≈ümagy≈àyzy ha√Ωy≈ü ed√Ω√§ris.
        </p>
        <button onclick="closeWelcome()" class="btn-green">D√ºkana giri≈ü üõçÔ∏è</button>
    </div>
</div>

<div id="saleNotify">
    <img id="saleImg" src="" style="width: 40px; height: 40px; border-radius: 5px; object-fit: cover;">
    <div style="font-size: 12px; color: var(--tekst);">
        <b id="saleUser">M√º≈üderi</b> <span style="color:var(--yasyl)">sargyt edildi</span><br>
        <small id="saleItem"></small>
    </div>
</div>

<div id="orderSuccess">
    <div class="modal-content" style="text-align: center;">
        <span style="font-size: 60px;">‚úÖ</span>
        <h2>Sargyt edildi!</h2>
        <p>Sargydy≈àyz √ºst√ºnlikli ugradyldy. Admin tiz wagtdan sizi≈à bilen habarla≈üar.</p>
        <button class="btn-green" onclick="document.getElementById('orderSuccess').style.display='none'">Bol√Ωar</button>
    </div>
</div>

<div id="cartModal">
    <div class="modal-content">
        <span class="close-btn" onclick="toggleCart(false)">&times;</span>
        <h2>üõí Sebedi≈àiz</h2>
        <div id="cartList"></div>
        <hr style="border:0.5px solid #333; margin: 15px 0;">
        <div style="display:flex; justify-content:space-between; font-weight:bold;">
            <span>Jemi:</span> <span id="cartTotal">0 TMT</span>
        </div>
        <button class="btn-green" onclick="checkout()">WhatsApp bilen sargyt et ‚úÖ</button>
    </div>
</div>

<div id="productModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeProductModal()">&times;</span>
        <div id="modalData"></div>
    </div>
</div>

<header>
    <div onclick="toggleTheme()" style="cursor:pointer; font-size:20px;">üåì</div>
    <h1>‚õ∞Ô∏è GARAKEL E-D√úKAN</h1>
    <div style="width:20px;"></div>
</header>
<div class="delivery-bar">üöö <span>Garakel i√ßine eltip bermek Mugt!</span></div>

<div class="container">
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Haryt g√∂zle..." oninput="searchProduct()">
    </div>

    <div class="slider-container"><div class="slides" id="slider"></div></div>
    
    <div class="categories">
        <button class="cat-btn active" onclick="filterCat('Hemmesi', this)">Hemmesi</button>
        <button class="cat-btn" onclick="filterCat('Ideg seri≈üdeleri', this)">Ideg seri≈üdeleri</button>
        <button class="cat-btn" onclick="filterCat('√ùuwujy seri≈üdeleri', this)">√ùuwujy seri≈üdeleri</button>
		<button class="cat-btn" onclick="filterCat('G√∂zellik', this)">G√∂zellik</button>
        <button class="cat-btn" onclick="filterCat('Parfum', this)">Parfum</button>
    </div>

    <div id="productGrid" class="grid"></div>

    <div class="comm-box">
        <h4>üí¨ Salamla≈üyk Tagtasy</h4>
        <div id="mainComments" style="max-height: 250px; overflow-y: auto;">√ù√ºklen√Ω√§r...</div>
        <div id="replyTo" style="display:none; font-size:11px; color:var(--yasyl); margin-top:10px;"></div>
        <input type="text" id="uName" placeholder="Ady≈àyz..." style="width:100%; margin-top:10px; background:#222; color:white; border:1px solid #444; padding:10px; border-radius:8px; box-sizing:border-box;">
        <textarea id="uComm" placeholder="Pikir √Ωazy≈à..." style="width:100%; height:60px; margin-top:5px; background:#222; color:white; border:1px solid #444; padding:10px; border-radius:8px; box-sizing:border-box;"></textarea>
        <button onclick="sendComment()" class="btn-green">Teswir üìù</button>
    </div>

    <div style="text-align:center; padding:10px; color:#888; font-size:13px;">
        üë§ ≈ûu g√ºnki girenler: <span id="vCount" style="color:var(--yasyl); font-weight:bold;">0</span>
    </div>

    <div class="footer">
        <b>Admin: Me≈àli A≈üyrowa</b><br>
        √Ñhli hukuklar goralan | 2026<br>
        ‚õ∞Ô∏è GARAKEL ONLINE D√úKAN
    </div>
</div>

<div class="bottom-nav">
    <div onclick="location.reload()" style="color:white; cursor:pointer;">üè† Ba≈ü sahypa</div>
    <div onclick="toggleCart(true)" style="color:white; cursor:pointer;">üõí Sebet <span id="cartCount" style="color:red; font-weight:bold;">0</span></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAdyL0Aqq19afQU0jHoqgH6EUvmZQRq-hY", databaseURL: "https://garakel-dukan-default-rtdb.firebaseio.com", projectId: "garakel-dukan" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
let allProducts = [], cart = [], currentReplyId = null;
    const myPhone = "99371563667";
    const today = new Date().toISOString().split('T')[0];

    // --- SORTIROWKA WE NOMERLEME (D√úZEDILDI) ---
    db.ref('products').on('value', snap => {
        const val = snap.val();
        // Firebase-den gel√Ω√§n harytlary ilki massiwa √∂w√ºr√Ω√§ris
        allProducts = val ? Object.keys(val).map(k => ({id: k, ...val[k]})) : [];
        
        // T√§ze haryt i≈à ba≈üda durar √Ωaly massiwy≈à nusgasyny tersine √∂w√ºr√Ω√§ris
        const sortedProducts = [...allProducts].reverse();
        
        render(sortedProducts);
        
        // Slider √º√ßin t√§ze go≈üulan ilkinji 5 haryt
        const sliderContent = sortedProducts.slice(0,5).map(h => 
            `<div class="slide"><img src="${h.img}"></div>`
        ).join('');
        document.getElementById('slider').innerHTML = sliderContent;
    });

   function render(list) {
    const grid = document.getElementById('productGrid');
    const totalItems = allProducts.length;

    grid.innerHTML = list.map((h, index) => {
        const displayNumber = totalItems - index;
        
        // Status bar bolsa ony g√∂rkezmek, √Ωok bolsa bo≈ü go√Ωmak
        const statusLabel = h.status ? `
            <div style="position: absolute; top: 0; right: 0; background: var(--sary); color: #000; 
                        font-size: 10px; padding: 3px 8px; border-bottom-left-radius: 12px; 
                        font-weight: bold; z-index: 50; box-shadow: -1px 1px 5px rgba(0,0,0,0.3);">
                ${h.status}
            </div>` : '';

        return `
            <div class="card" style="position: relative; overflow: hidden; display: flex; flex-direction: column; align-items: center;">
                <div style="position: absolute; top: 0; left: 0; background: var(--bag); color: white; 
                            font-size: 11px; padding: 3px 8px; border-bottom-right-radius: 12px; 
                            font-weight: bold; z-index: 50;">
                    #${displayNumber}
                </div>

                ${statusLabel}
                
                <div style="width: 100%; height: 120px; display: flex; align-items: center; justify-content: center; background: #fff; border-radius: 8px; overflow: hidden;">
                    <img src="${h.img}" onclick="openProductModal('${h.id}')" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                </div>

                <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <div style="font-weight:bold; font-size:13px; margin-top:8px; height:35px; overflow:hidden; width: 100%;">
                    ${h.name}
                </div>
                <div style="color:var(--yasyl); font-weight:bold; margin: 5px 0;">${h.price} TMT</div>
                <button onclick="addToCart('${h.id}')" class="btn-green" style="padding:8px; font-size:11px; width: 100%;">
                    Sebede go≈ü
                </button>
            </div>`;
    }).join('');
}

    function render(list) {
        document.getElementById('productGrid').innerHTML = list.map(h => `
            <div class="card">
                <img src="${h.img}" onclick="openProductModal('${h.id}')">
                <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <div style="font-weight:bold; font-size:13px; margin-top:8px; height:35px; overflow:hidden;">${h.name}</div>
                <div style="color:var(--yasyl); font-weight:bold;">${h.price} TMT</div>
                <button onclick="addToCart('${h.id}')" class="btn-green" style="padding:8px; font-size:11px;">Sebede go≈ü</button>
            </div>`).join('');
    }

    function searchProduct() {
        const txt = document.getElementById('searchInput').value.toLowerCase();
        render(allProducts.filter(h => h.name.toLowerCase().includes(txt)));
    }

    function addToCart(id) {
        cart.push(allProducts.find(p => p.id === id));
        document.getElementById('cartCount').innerText = cart.length;
    }

    function toggleCart(show) {
        document.getElementById('cartModal').style.display = show ? 'flex' : 'none';
        if(show) {
            let total = 0;
            document.getElementById('cartList').innerHTML = cart.map((h, i) => {
                total += parseFloat(h.price);
                return `<div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #333;">
                    <span>${h.name}</span> <span>${h.price} TMT</span>
                </div>`;
            }).join('') || "Sebet bo≈ü...";
            document.getElementById('cartTotal').innerText = total + " TMT";
        }
    }

    function checkout() {
        if(cart.length === 0) return;
        let t = "‚õ∞Ô∏è GARAKEL SARGYT:\n";
        cart.forEach((h, i) => t += `${i+1}. ${h.name} (${h.price} TMT)\n`);
        window.open(`https://wa.me/${myPhone}?text=${encodeURIComponent(t)}`, '_blank');
        cart = []; toggleCart(false); document.getElementById('cartCount').innerText = 0;
        document.getElementById('orderSuccess').style.display = 'flex';
    }

    function openProductModal(id) {
        const h = allProducts.find(p => p.id === id);
        document.getElementById('modalData').innerHTML = `
            <img src="${h.img}" style="width:100%; max-height:250px; object-fit:contain; background:#fff; border-radius:10px;">
            <h2>${h.name}</h2>
            <div style="font-size:20px; color:#ffca28; margin-bottom:10px;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
            <h3 style="color:var(--yasyl);">${h.price} TMT</h3>
            <p style="font-size:14px; opacity:0.8;">${h.desc || ''}</p>
            <button onclick="addToCart('${h.id}'); closeProductModal();" class="btn-green">üõí Sebede go≈ü</button>`;
        document.getElementById('productModal').style.display = 'flex';
    }

    function closeProductModal() { document.getElementById('productModal').style.display = 'none'; }

    // Teswirler
    db.ref('comments').on('value', snap => {
        let h = ""; const d = snap.val();
        if(d) Object.keys(d).reverse().forEach(id => {
            h += `<div class="c-item"><b>${d[id].name}:</b> ${d[id].text} 
            <span style="color:var(--yasyl); font-size:10px; cursor:pointer;" onclick="prepReply('${id}','${d[id].name}')"> [JOGAP]</span>`;
            if(d[id].replies) Object.values(d[id].replies).forEach(r => h += `<div class="reply"><b>${r.name}:</b> ${r.text}</div>`);
            h += `</div>`;
        });
        document.getElementById('mainComments').innerHTML = h || "Teswir √Ωok.";
    });

    function prepReply(id, n) { currentReplyId = id; document.getElementById('replyTo').innerText = n + " √º√ßin jogap..."; document.getElementById('replyTo').style.display="block"; document.getElementById('uComm').focus(); }

    function sendComment() {
        const t = document.getElementById('uComm').value, n = document.getElementById('uName').value || "M√º≈üderi";
        if(!t) return;
        if(currentReplyId) {
            db.ref('comments/'+currentReplyId+'/replies').push({name: "Admin ‚õ∞Ô∏è", text: t});
            currentReplyId = null; document.getElementById('replyTo').style.display="none";
        } else {
            db.ref('comments').push({name: n, text: t, time: Date.now()});
        }
        document.getElementById('uComm').value = "";
    }

    function filterCat(c, b) {
        document.querySelectorAll('.cat-btn').forEach(x => x.classList.remove('active'));
        b.classList.add('active');
        render(c === 'Hemmesi' ? allProducts : allProducts.filter(h => h.category === c));
    }

    let cur = 0; setInterval(() => {
        const s = document.getElementById('slider');
        if(s && s.children.length > 0) { 
            cur = (cur + 1) % s.children.length;
            s.style.transform = `translateX(-${cur * 100}%)`; 
        }
    }, 4500);
</script>
</body>
</html>
