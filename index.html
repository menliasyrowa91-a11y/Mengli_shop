<!DOCTYPE html>
<html lang="tk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè† GARAKEL E-D√úKAN</title>
    <style>
        :root { --bag: #1b5e20; --arka: #f4f7f1; --yasyl: #2e7d32; --gyp: #d32f2f; }
        body { font-family: -apple-system, sans-serif; margin: 0; background: var(--arka); padding-bottom: 100px; color: #333; }
        
        /* Header */
        header { position: fixed; top: 0; width: 100%; background: linear-gradient(135deg, var(--bag), #2e7d32); color: white; text-align: center; padding: 15px 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        header h1 { margin: 0; font-size: 20px; text-transform: uppercase; }

        .container { max-width: 600px; margin: auto; padding-top: 80px; }

        /* √ùol g√∂rkeziji instruksi√Ωa */
        .help-box { background: #fffde7; border: 1px dashed #fbc02d; padding: 10px; margin: 10px; border-radius: 8px; font-size: 13px; text-align: center; }

        /* G√∂zleg b√∂l√ºmi */
        .search-container { padding: 10px; }
        #searchInput { width: 100%; padding: 12px 20px; border-radius: 30px; border: 2px solid var(--bag); box-sizing: border-box; font-size: 16px; outline: none; }

        /* Kategori√Ωalar */
        .categories { display: flex; overflow-x: auto; gap: 8px; padding: 10px; scrollbar-width: none; }
        .categories::-webkit-scrollbar { display: none; }
        .cat-btn { background: white; border: 1px solid #ddd; padding: 10px 18px; border-radius: 25px; font-size: 14px; white-space: nowrap; cursor: pointer; font-weight: bold; }
        .cat-btn.active { background: var(--bag); color: white; border-color: var(--bag); }

        /* Haryt Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: white; border-radius: 12px; padding: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; border: 1px solid #eee; }
        .card img { width: 100%; height: 150px; object-fit: contain; border-radius: 8px; margin-bottom: 10px; }
        .price { color: var(--yasyl); font-size: 18px; font-weight: bold; margin: 5px 0; }
        
        /* D√ºwmeler */
        .btn { border: none; width: 100%; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.3s; }
        .add { background: var(--bag); color: white; }
        .rem { background: #ffebee; color: var(--gyp); border: 1px solid var(--gyp); }

        /* Sebet Summary */
        .cart-overlay { background: white; border-top: 3px solid var(--bag); padding: 20px; margin-top: 20px; }
        .total-price { font-size: 22px; font-weight: bold; color: var(--bag); margin-bottom: 15px; }
        
        /* Sargyt D√ºwmeleri */
        .order-btn { display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; color: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; font-weight: bold; font-size: 16px; }
        .wa { background: #25D366; }
        .imo { background: #00a1ff; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; height: 70px; border-top: 1px solid #ddd; z-index: 1000; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 12px; color: #555; position: relative; }
        .badge { position: absolute; top: 10px; right: 25%; background: red; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 11px; display: flex; align-items: center; justify-content: center; }

        .footer { text-align: center; padding: 30px; font-size: 12px; color: #777; background: #fff; margin-top: 20px; }
    </style>
</head>
<body>

<header>
    <h1>GARAKEL E-D√úKAN</h1>
</header>

<div class="container">
    <div class="help-box" id="stepText">
        üõí Harytlary sebede go≈üu≈à we a≈üakdaky "Sebedim" d√ºwmesine basy≈à.
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Haryt g√∂zle (mysal: sabyn...)" oninput="search()">
    </div>

    <div class="categories" id="catBar">
        <button class="cat-btn active" onclick="filterCat('Hemmesi', this)">Hemmesi</button>
        <button class="cat-btn" onclick="filterCat('Ideg', this)">Ideg</button>
        <button class="cat-btn" onclick="filterCat('Arassalyk', this)">Arassalyk</button>
        <button class="cat-btn" onclick="filterCat('√ùuwujy seri≈üdeler', this)">√ùuwujylar</button>
        <button class="cat-btn" onclick="filterCat('G√∂zellik', this)">G√∂zellik</button>
        <button class="cat-btn" onclick="filterCat('Parfum', this)">Parfum</button>
    </div>

    <div id="mainView">
        <div id="productGrid" class="grid"></div>
    </div>

    <div id="cartView" style="display:none; padding: 10px;">
        <h2 style="text-align: center;">Sizi≈à Sebedi≈àiz</h2>
        <div id="cartItems"></div>
        <div class="cart-overlay" id="orderSection">
            <div class="total-price">Jemi: <span id="totalSum">0</span> TMT</div>
            <p style="font-size: 13px; color: #666;">Sargyt etmek √º√ßin a≈üakdaky d√ºwmeleri≈à birine basy≈à:</p>
            <a id="waLink" href="#" class="order-btn wa">WhatsApp bilen ugrat</a>
            <a id="imoLink" href="#" class="order-btn imo">Imo bilen ugrat</a>
            <button class="btn" style="background:#888; color:#white; margin-top:10px;" onclick="home()">‚Üê Haryt go≈ümaga dowam et</button>
        </div>
    </div>

    <div class="footer">
        <b>GARAKEL E-D√úKAN</b><br>
        Admin: Me≈àli A≈üyrowa<br>
        Telefon: +993 71 563667<br>
        <i>2026 √Ñhli hukuklar goralan</i>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item" onclick="home()">üè†<br>Ba≈ü sahypa</div>
    <div class="nav-item" onclick="showCart()">
        üõí<br>Sebedim 
        <span class="badge" id="cartBadge">0</span>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAdyL0Aqq19afQU0jHoqgH6EUvmZQRq-hY",
        databaseURL: "https://garakel-dukan-default-rtdb.firebaseio.com",
        projectId: "garakel-dukan"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let allProducts = [];
    let cart = JSON.parse(localStorage.getItem('cart_v2')) || [];
    const myPhone = "99371563667";

    // Harytlary Firebase-den al
    db.ref('products').on('value', snap => {
        const data = snap.val();
        if(data) {
            allProducts = Object.keys(data).map(k => ({ id: k, ...data[k] })).reverse();
            renderProducts(allProducts);
            updateBadge();
        }
    });

    function renderProducts(list) {
        const grid = document.getElementById('productGrid');
        grid.innerHTML = list.map(h => {
            const inCart = cart.some(c => c.id === h.id);
            return `
                <div class="card">
                    <img src="${h.img}" alt="${h.name}">
                    <div style="font-weight:bold; height:35px; overflow:hidden; font-size:14px;">${h.name}</div>
                    <div class="price">${h.price} TMT</div>
                    <button class="btn ${inCart?'rem':'add'}" onclick="toggleCart('${h.id}')">
                        ${inCart ? 'üõí A√Ωyr' : '‚ûï Sebede go≈ü'}
                    </button>
                </div>`;
        }).join('');
    }

    function toggleCart(id) {
        const index = cart.findIndex(item => item.id === id);
        if(index > -1) {
            cart.splice(index, 1);
        } else {
            const prod = allProducts.find(p => p.id === id);
            cart.push(prod);
        }
        localStorage.setItem('cart_v2', JSON.stringify(cart));
        updateBadge();
        renderProducts(allProducts);
        
        // Ulanyja k√∂mek√ßi tekst
        if(cart.length > 0) {
            document.getElementById('stepText').innerHTML = "‚úÖ Haryt go≈üuldy! Indi a≈üakdaky <b>'Sebedim'</b> d√ºwmesine basy≈à.";
            document.getElementById('stepText').style.background = "#e8f5e9";
        }
    }

    function updateBadge() {
        document.getElementById('cartBadge').innerText = cart.length;
    }

    function showCart() {
        document.getElementById('mainView').style.display = 'none';
        document.getElementById('cartView').style.display = 'block';
        document.getElementById('stepText').innerHTML = "üìù Sargydy≈àyzy barla≈à we a≈üakdaky d√ºwmelerden admina ugrady≈à.";
        
        const cartItems = document.getElementById('cartItems');
        if(cart.length === 0) {
            cartItems.innerHTML = "<p style='text-align:center; padding:30px;'>Sebedi≈àiz bo≈ü...</p>";
            document.getElementById('orderSection').style.display = 'none';
        } else {
            document.getElementById('orderSection').style.display = 'block';
            let total = 0;
            cartItems.innerHTML = cart.map((h, i) => {
                total += parseFloat(h.price);
                return `
                    <div style="display:flex; align-items:center; background:white; margin-bottom:5px; padding:10px; border-radius:8px;">
                        <img src="${h.img}" style="width:50px; height:50px; object-fit:contain; margin-right:10px;">
                        <div style="flex:1; font-size:14px;"><b>${h.name}</b><br>${h.price} TMT</div>
                        <button onclick="toggleCart('${h.id}'); showCart();" style="border:none; background:none; color:red; font-size:20px;">√ó</button>
                    </div>`;
            }).join('');
            
            document.getElementById('totalSum').innerText = total;
            
            // Sargyt hatyny ta√Ω√Ωarla
            const text = "Salam, GARAKEL E-D√úKAN. Men ≈üu harytlary sargyt etmek isle√Ω√§rin:\n\n" + 
                         cart.map((h, i) => (i+1) + ". " + h.name + " (" + h.price + " TMT)").join("\n") + 
                         "\n\nJemi baha: " + total + " TMT";
            
            const encodedText = encodeURIComponent(text);
            document.getElementById('waLink').href = `https://wa.me/${myPhone}?text=${encodedText}`;
            document.getElementById('imoLink').href = `imo://chat?phone=${myPhone}&text=${encodedText}`;
        }
    }

    function home() {
        document.getElementById('mainView').style.display = 'block';
        document.getElementById('cartView').style.display = 'none';
        document.getElementById('stepText').innerHTML = "üõí Harytlary sebede go≈üu≈à we a≈üakdaky 'Sebedim' d√ºwmesine basy≈à.";
        renderProducts(allProducts);
    }

    function search() {
        const val = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allProducts.filter(p => p.name.toLowerCase().includes(val) || (p.category && p.category.toLowerCase().includes(val)));
        renderProducts(filtered);
    }

    function filterCat(cat, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if(cat === 'Hemmesi') renderProducts(allProducts);
        else renderProducts(allProducts.filter(p => p.category === cat));
    }
</script>

</body>
</html>
